[{"title":"CNNè®­ç»ƒæ¨¡å‹å®ç°éªŒè¯ç è‡ªåŠ¨è¯†åˆ«","path":"/2025/03/28/CNNè®­ç»ƒæ¨¡å‹å®ç°éªŒè¯ç è‡ªåŠ¨è¯†åˆ«/","content":"æ³¨ï¼šæœ¬æ–‡ä¸­æ‰€æœ‰ä»£ç å‡æ˜¯é—®AIå®ç°ï¼ˆå› ä¸ºæˆ‘æ˜¯ä¸€ç‚¹ä¸ä¼šå†™ğŸ’€ï¼‰é¢˜ç›®ï¼š2000ä¸ªéªŒè¯ç ï¼Œæ­£ç¡®ç‡95%å³å¯é€šè¿‡ å»æœäº†ä¸€ä¸‹å¸¸è§çš„æœ¬åœ°ocrå¹³å°ï¼Œå°è¯•æ­å»ºddddocr https://github.com/sml2h3/ddddocrhttps://github.com/sml2h3/ddddocr å°è¯•äº†ä¸€ä¸‹ç›´æ¥ä½¿ç”¨è‡ªå¸¦çš„æ¨¡å‹å‘ç°æ•ˆæœéå¸¸ä¸ç†æƒ³ æ‰€ä»¥å…ˆå°è¯•å¯¹å›¾ç‰‡è¿›è¡Œå¤„ç†ï¼ˆæ»¤æ³¢ï¼‰ï¼ˆè¿™é‡Œæˆ‘è¦æä¸€ä½è€å¸ˆäº†â€“èµ–å¿—è¾‰è€å¸ˆï¼Œä»–ä¸Šä¸ªå­¦æœŸç»™æˆ‘ä»¬åˆ†é…ä»»åŠ¡å»åšpreï¼Œæˆ‘è´Ÿè´£çš„å°±æ˜¯æ»¤æ³¢å™¨ï¼Œè¿™æ‰çŸ¥é“ä¸–ç•Œä¸Šæœ‰æ»¤æ³¢å™¨è¿™ç§ä¸œè¥¿ï¼Œæ‰èƒ½æŠŠè¿™é“é¢˜åšå‡ºæ¥ï¼‰ å…ˆåˆ›ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒå§ï¼Œè¿™è¾¹ç”¨çš„æ˜¯python3.9ï¼ˆç‰ˆæœ¬å¤ªé«˜è²Œä¼¼ä¸è¡Œï¼‰ 123&quot;C:\\Users\\xiaoy\\AppData\\Local\\Programs\\Python\\Python39\\python.exe&quot; -m venv venv_py39venv_py39\\Scripts\\activate å…ˆå»æ‰è“è‰²æ··æ·†çº¿æ¡ï¼Œå¹¶ç°åº¦å¤„ç† å»é™¤è“è‰²æ··æ·†çº¿æ¡123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051from PIL import Imageimport numpy as npimport colorsysdef rgb_to_hsv(rgb): return colorsys.rgb_to_hsv(rgb[0]/255.0, rgb[1]/255.0, rgb[2]/255.0)def remove_specific_rgba(img, target_rgba): &quot;&quot;&quot;åˆ é™¤ç‰¹å®šRGBAé¢œè‰²çš„åƒç´ ï¼ˆè®¾ç½®ä¸ºé€æ˜ï¼‰&quot;&quot;&quot; img = img.convert(&quot;RGBA&quot;) data = np.array(img) r, g, b, a = data[:,:,0], data[:,:,1], data[:,:,2], data[:,:,3] mask = (r == target_rgba[0]) &amp; (g == target_rgba[1]) &amp; (b == target_rgba[2]) &amp; (a == target_rgba[3]) data[mask] = [0, 0, 0, 0] # è®¾ç½®ä¸ºå®Œå…¨é€æ˜ return Image.fromarray(data)# å‚æ•°è®¾ç½®target_blue = (64, 56, 247)hue_range = (0.58, 0.72)sat_threshold = 0.3val_threshold = 0.5remove_color = (254, 224, 222, 255) # æ–°å¢è¦åˆ é™¤çš„RGBAé¢œè‰²# è¯»å–å›¾ç‰‡img = Image.open(r&quot;F:\\ctf\\ocr proj\\ddddocr-full\\generate_captcha.png&quot;).convert(&quot;RGB&quot;)pixels = np.array(img)# åŸå§‹é¢œè‰²è¿‡æ»¤æµç¨‹hsv_pixels = np.array([[[colorsys.rgb_to_hsv(p[0]/255., p[1]/255., p[2]/255.)] for p in row] for row in pixels])hsv_pixels = np.squeeze(hsv_pixels)h_mask = (hsv_pixels[:,:,0] &gt;= hue_range[0]) &amp; (hsv_pixels[:,:,0] &lt;= hue_range[1])s_mask = hsv_pixels[:,:,1] &gt;= sat_thresholdv_mask = hsv_pixels[:,:,2] &gt;= val_thresholdcombined_mask = h_mask &amp; s_mask &amp; v_maskpixels[combined_mask] = [255, 255, 255]color_img = Image.fromarray(pixels)# æ–°å¢RGBAåˆ é™¤æ¨¡å—color_img = remove_specific_rgba(color_img, remove_color)# ä¿å­˜å½©è‰²ç»“æœï¼ˆå¸¦é€æ˜é€šé“ï¼‰color_img.save(&quot;filtered_image_hsv.png&quot;)print(&quot;æ”¹è¿›åçš„è¿‡æ»¤å®Œæˆï¼Œå½©è‰²ç»“æœå·²ä¿å­˜ä¸º filtered_image_hsv.png&quot;)# è½¬æ¢ä¸ºç°åº¦ï¼ˆè‡ªåŠ¨å¿½ç•¥é€æ˜åƒç´ ï¼‰gray_img = color_img.convert(&#x27;L&#x27;)gray_img.save(&quot;filtered_image_gray.png&quot;)print(&quot;ç°åº¦ç»“æœå·²ä¿å­˜ä¸º filtered_image_gray.png&quot;) åŸå›¾: æ•ˆæœå¦‚ä¸‹: æ¸…æ™°å¤šäº†ï¼Œè¿™æ—¶å€™å»è¯†åˆ«è¿˜æ˜¯ä¸ç†æƒ³ï¼Œå°±åˆåŠ äº†ä¸ªé”åŒ–æ»¤æ³¢å™¨æ•ˆæœå¦‚ä¸‹: è¿˜æ˜¯è¯†åˆ«é”™è¯¯ äºæ˜¯æˆ‘å°è¯•ä½¿ç”¨æœ€åçš„æ–¹æ³•ç”Ÿæˆè®­ç»ƒé›†ï¼Œæœ¬åœ°è®­ç»ƒï¼Œç”¨æœ¬åœ°è®­ç»ƒçš„æ¨¡å‹æ¥è¯†åˆ«ç”¨åˆ°äº†ddddocr_train https://github.com/sml2h3/dddd_trainerhttps://github.com/sml2h3/dddd_trainer å®‰è£…cudaå’Œpytorchè¿™é‡Œä¸å†èµ˜è¿°ï¼ˆåæ­£æˆ‘æ˜¯ç¬¬ä¸€æ¬¡å®‰è£…å¹¶ç”¨æ˜¾å¡è®­ç»ƒï¼Œè¿‡ç¨‹å¯ä»¥è¯´æ˜¯ä¸€æ³¢ä¸‰æŠ˜ï¼Œæœ‰å¥½å¤šæŠ¥é”™ï¼Œä¸è¿‡å¥½åœ¨æœ‰AIå¸®æˆ‘æŠŠé—®é¢˜éƒ½è§£å†³äº†ï¼‰ ddddocr_trainçš„githubæœ‰è¯¦ç»†ä½¿ç”¨æ–¹æ³• è¿™é“é¢˜ç›®ç»™äº†phpæºç ï¼Œæ‰€ä»¥å…ˆç”Ÿæˆå‡ ä¸‡å¼ æ ‡æ³¨å¥½çš„éªŒè¯ç  ç”¨AIä¿®æ”¹é¢˜ç›®ä¸­çš„æºç ï¼Œç”¨æˆ·æ¯æ¬¡è§¦å‘ç”Ÿæˆå¤šå¼ éªŒè¯ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263&lt;?php// è®¾ç½®ä¿å­˜è·¯å¾„$savePath = &#x27;D:/phpstudy_pro/WWW/IMAGE/captcha&#x27;;// åˆ›å»ºç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰if (!is_dir($savePath)) &#123; mkdir($savePath, 0755, true);&#125;// ç”Ÿæˆ100å¼ éªŒè¯ç for ($i = 0; $i &lt; 100; $i++) &#123; generateCaptcha($savePath);&#125;function generateCaptcha($savePath) &#123; // åˆ›å»ºå›¾åƒèµ„æº $image = imagecreate(100, 50); // ç”Ÿæˆéšæœºé¢œè‰² $background_color = imagecolorallocate($image, rand(220, 255), rand(220, 255), rand(220, 255)); $text_color1 = imagecolorallocate($image, rand(0, 100), rand(0, 100), rand(0, 100)); $text_color2 = imagecolorallocate($image, rand(0, 100), rand(0, 100), rand(0, 100)); $line_color = imagecolorallocate($image, 0, 0, 255); // å¡«å……èƒŒæ™¯ imagefill($image, 0, 0, $background_color); // ç”ŸæˆéšæœºéªŒè¯ç  $chars = &quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;; $code = substr(str_shuffle($chars), 0, 4); // ç»˜åˆ¶éªŒè¯ç æ–‡æœ¬ $font_size = 5; for ($i = 0; $i &lt; strlen($code); $i++) &#123; $color = ($i % 2 == 0) ? $text_color1 : $text_color2; $x = 10 + ($i * 15) + mt_rand(-5, 5); $y = mt_rand(10, 30); imagestring($image, $font_size, $x, $y, $code[$i], $color); &#125; // æ·»åŠ å¹²æ‰°çº¿ for ($i = 0; $i &lt; 5; $i++) &#123; imageline($image, mt_rand(0, 100), mt_rand(0, 50), mt_rand(0, 100), mt_rand(0, 50), $line_color ); &#125; // ç”Ÿæˆå”¯ä¸€æ–‡ä»¶åï¼ˆéªŒè¯ç å†…å®¹+å¾®ç§’æ—¶é—´æˆ³ï¼‰ $timestamp = str_replace(&#x27;.&#x27;, &#x27;_&#x27;, microtime(true)); $filename = &quot;&#123;$code&#125;_&#123;$timestamp&#125;.png&quot;; $filePath = $savePath . &#x27;/&#x27; . $filename; // ä¿å­˜å›¾åƒ imagepng($image, $filePath); imagedestroy($image);&#125;echo &quot;å·²ç”Ÿæˆ100å¼ éªŒè¯ç åˆ°ç›®å½•ï¼š&#123;$savePath&#125;&quot;;?&gt; è¿™é‡Œç”¨æ—¶é—´æˆ³ä¸å¯¹ï¼Œè®­ç»ƒä¸å‡ºæ¥ï¼Œåæ¥åˆç”¨pythonè„šæœ¬æŠŠæ ‡æ³¨å¥½çš„åé¢çš„æ—¶é—´æˆ³å…¨éƒ¨æ¢æˆddddocrè¦æ±‚çš„32ä½éšæœºhexå€¼ æ‰¹é‡é‡å‘½åæˆè§„èŒƒæ ¼å¼1234567891011121314151617181920212223242526272829303132333435363738394041424344import osimport shutilimport secretsdef rename_and_copy_images(): # å®šä¹‰æºç›®å½•å’Œç›®æ ‡ç›®å½• source_dir = r&#x27;D:\\phpstudy_pro\\WWW\\IMAGE\\captcha_sharped&#x27; dest_dir = r&#x27;D:\\phpstudy_pro\\WWW\\IMAGE ewcaptcha&#x27; # æ”¯æŒçš„å›¾ç‰‡æ‰©å±•ååˆ—è¡¨ image_extensions = (&#x27;.png&#x27;, &#x27;.jpg&#x27;, &#x27;.jpeg&#x27;, &#x27;.gif&#x27;, &#x27;.bmp&#x27;) # åˆ›å»ºç›®æ ‡ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ os.makedirs(dest_dir, exist_ok=True) # éå†æºç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ for filename in os.listdir(source_dir): # æ£€æŸ¥æ˜¯å¦ä¸ºå›¾ç‰‡æ–‡ä»¶ if filename.lower().endswith(image_extensions): # åˆ†ç¦»æ–‡ä»¶åå’Œæ‰©å±•å name_part, ext = os.path.splitext(filename) # è·³è¿‡ä¸è¶³5ä¸ªå­—ç¬¦çš„æ–‡ä»¶å if len(name_part) &lt; 5: print(f&quot;è­¦å‘Šï¼šè·³è¿‡æ–‡ä»¶ &#x27;&#123;filename&#125;&#x27;ï¼Œæ–‡ä»¶åé•¿åº¦ä¸è¶³5ä¸ªå­—ç¬¦&quot;) continue # æ„å»ºæ–°æ–‡ä»¶å prefix = name_part[:5] random_hex = secrets.token_hex(16) # ç”Ÿæˆ32ä½éšæœºhex new_filename = f&quot;&#123;prefix&#125;&#123;random_hex&#125;&#123;ext&#125;&quot; # æ„å»ºå®Œæ•´æ–‡ä»¶è·¯å¾„ src_path = os.path.join(source_dir, filename) dst_path = os.path.join(dest_dir, new_filename) # å¤åˆ¶æ–‡ä»¶åˆ°ç›®æ ‡ç›®å½• shutil.copy2(src_path, dst_path) print(f&quot;å·²å¤„ç†ï¼š&#123;filename&#125; -&gt; &#123;new_filename&#125;&quot;)if __name__ == &quot;__main__&quot;: rename_and_copy_images() print(&quot;æ‰€æœ‰å›¾ç‰‡å¤„ç†å®Œæˆï¼&quot;) æ¥ç€å°±æ˜¯ä¸¤ä¸ªæ‰¹é‡æ»¤æ³¢ï¼ˆæŠŠåŸæ¥çš„å•å¼ å›¾ç‰‡æ»¤æ³¢ä»£ç ä¸¢è¿›AIï¼Œç»™å‡ºåŸå§‹å›¾ç‰‡è·¯å¾„å’Œç›®æ ‡æ–‡ä»¶å¤¹ï¼Œè®©AIç”Ÿæˆï¼Œå¦‚æœæœ‰æŠ¥é”™å°±æŠŠé”™è¯¯ä¿¡æ¯æŠ•å–‚ç»™AIï¼Œæ ¹æ®AIç”Ÿæˆçš„è§£å†³æ–¹æ¡ˆé€æ­¥æ’æŸ¥ï¼‰ å»é™¤æ··æ·†è“è‰²çº¿æ¡123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566from PIL import Imageimport numpy as npimport colorsysimport osimport globdef rgb_to_hsv(rgb): return colorsys.rgb_to_hsv(rgb[0]/255.0, rgb[1]/255.0, rgb[2]/255.0)def remove_specific_rgba(img, target_rgba): &quot;&quot;&quot;åˆ é™¤ç‰¹å®šRGBAé¢œè‰²çš„åƒç´ ï¼ˆè®¾ç½®ä¸ºé€æ˜ï¼‰&quot;&quot;&quot; img = img.convert(&quot;RGBA&quot;) data = np.array(img) r, g, b, a = data[:,:,0], data[:,:,1], data[:,:,2], data[:,:,3] mask = (r == target_rgba[0]) &amp; (g == target_rgba[1]) &amp; (b == target_rgba[2]) &amp; (a == target_rgba[3]) data[mask] = [0, 0, 0, 0] return Image.fromarray(data)# å‚æ•°è®¾ç½®target_blue = (64, 56, 247)hue_range = (0.58, 0.72)sat_threshold = 0.3val_threshold = 0.5remove_color = (254, 224, 222, 255)# è·¯å¾„è®¾ç½®input_dir = r&#x27;D:\\phpstudy_pro\\WWW\\IMAGE\\captcha&#x27;output_dir = r&#x27;D:\\phpstudy_pro\\WWW\\IMAGE\\captcha_filtered&#x27;# åˆ›å»ºè¾“å‡ºç›®å½•os.makedirs(output_dir, exist_ok=True)# å¤„ç†æ‰€æœ‰å›¾ç‰‡for img_path in glob.glob(os.path.join(input_dir, &#x27;*&#x27;)): try: # è¯»å–å›¾ç‰‡ img = Image.open(img_path).convert(&quot;RGB&quot;) pixels = np.array(img) # é¢œè‰²è¿‡æ»¤ hsv_pixels = np.array([[[colorsys.rgb_to_hsv(p[0]/255., p[1]/255., p[2]/255.)] for p in row] for row in pixels]) hsv_pixels = np.squeeze(hsv_pixels) h_mask = (hsv_pixels[:,:,0] &gt;= hue_range[0]) &amp; (hsv_pixels[:,:,0] &lt;= hue_range[1]) s_mask = hsv_pixels[:,:,1] &gt;= sat_threshold v_mask = hsv_pixels[:,:,2] &gt;= val_threshold combined_mask = h_mask &amp; s_mask &amp; v_mask pixels[combined_mask] = [255, 255, 255] color_img = Image.fromarray(pixels) # RGBAåˆ é™¤ color_img = remove_specific_rgba(color_img, remove_color) # è½¬æ¢ä¸ºç°åº¦ gray_img = color_img.convert(&#x27;L&#x27;) # ä¿å­˜ç»“æœ output_path = os.path.join(output_dir, os.path.basename(img_path)) gray_img.save(output_path) print(f&quot;å¤„ç†å®Œæˆ: &#123;os.path.basename(img_path)&#125;&quot;) except Exception as e: print(f&quot;å¤„ç†å¤±è´¥: &#123;os.path.basename(img_path)&#125; - &#123;str(e)&#125;&quot;) é”åŒ–å¤„ç†123456789101112131415161718192021222324252627282930313233343536373839404142434445from PIL import Imageimport numpy as npimport osimport glob# è·¯å¾„é…ç½®input_dir = r&#x27;D:\\phpstudy_pro\\WWW\\IMAGE\\captcha_filtered&#x27;output_dir = r&#x27;D:\\phpstudy_pro\\WWW\\IMAGE\\captcha_sharped&#x27;# é”åŒ–å·ç§¯æ ¸ï¼ˆæ‹‰æ™®æ‹‰æ–¯å¢å¼ºï¼‰sharpen_kernel = np.array([ [ 0, -1, 0], [-1, 5, -1], [ 0, -1, 0]], dtype=np.float32)def sharpen_image(img_array): &quot;&quot;&quot;æ‰§è¡Œå·ç§¯é”åŒ–æ“ä½œï¼Œå¿½ç•¥è¾¹ç¼˜åƒç´ &quot;&quot;&quot; filtered = np.zeros_like(img_array) for i in range(1, img_array.shape[0]-1): for j in range(1, img_array.shape[1]-1): filtered[i, j] = np.sum(img_array[i-1:i+2, j-1:j+2] * sharpen_kernel) return np.clip(filtered, 0, 255).astype(np.uint8)# åˆ›å»ºè¾“å‡ºç›®å½•os.makedirs(output_dir, exist_ok=True)# æ‰¹é‡å¤„ç†for img_path in glob.glob(os.path.join(input_dir, &#x27;*&#x27;)): try: # è¯»å–æ–‡ä»¶ img = Image.open(img_path).convert(&#x27;L&#x27;) # æ‰§è¡Œé”åŒ– sharpened_array = sharpen_image(np.array(img, dtype=np.float32)) # ä¿å­˜ç»“æœ output_path = os.path.join(output_dir, os.path.basename(img_path)) Image.fromarray(sharpened_array).save(output_path) print(f&quot;é”åŒ–æˆåŠŸ: &#123;os.path.basename(img_path)&#125;&quot;) except Exception as e: print(f&quot;å¤„ç†å¤±è´¥: &#123;os.path.basename(img_path)&#125; - &#123;str(e)&#125;&quot;) æœ€åæ‹¿åˆ°3ä¸‡å¤šå¼ æ ‡æ³¨å¥½çš„éªŒè¯ç  æ‹¿å»è®­ç»ƒåœ¨ddddocr_trainç›®å½•ä¸‹æ–°å»ºè™šæ‹Ÿç¯å¢ƒï¼Œç„¶å è®­ç»ƒ123python app.py create testpython app.py cache test D:\\phpstudy_pro\\WWW\\IMAGE ewcaptchapython app.py train test è®©æ˜¾å¡å»è®­ç»ƒå³å¯è¿™ä¸ªè®­ç»ƒç¨‹åºé»˜è®¤97%å‡†ç¡®ç‡ä¼šåœæ­¢å¹¶å¯¼å‡ºonnxæ¨¡å‹ï¼Œç„¶åæŠŠåŸæ¥çš„è¯†åˆ«è„šæœ¬åŠ ä¸Šå¯¼å…¥è¿™ä¸ªonnxæ¨¡å‹å³å¯ æ¯1000stepä¼šè¿›è¡Œaccæ£€æµ‹ï¼Œå¦‚å›¾ï¼Œç¬¬ä¸€æ¬¡æ˜¯0åˆšå¼€å§‹è®­ç»ƒæ¯”è¾ƒæ…¢ï¼Œåé¢ä¼šå˜å¿« åœ¨ç¬¬7000stepç¬¬ä¸€æ¬¡å‡ºç°accä¸ä¸º0ï¼Œè€å¿ƒç­‰å¾…å³å¯ . ç”¨4060ç®—çš„ï¼Œè·Ÿå¤§æ¨¡å‹æ¯”èµ·æ¥ï¼Œè¿™ä¸ªæ˜¾å­˜å ç”¨ç‡éå¸¸ä½ç¬¬8000stepç›´æ¥0.71875 10000stepåˆ°äº†0.9375ç¬¬14000é¦–æ¬¡åˆ°äº†1.0ï¼Œä¹‹ååœ¨0.96åˆ°1.0ä¹‹é—´æµ®åŠ¨ è®©AIåˆ†æä¸€ä¸‹æ—¥å¿— çœ‹AIè§£è¯»çš„æ§åˆ¶å°è¿™äº›æ•°æ®éƒ½æ˜¯ä»€ä¹ˆæ„æ€å°±è¡Œäº†ï¼Œä¸‹é¢è¿˜ç»™äº†ä¼˜åŒ–çš„ä»£ç ï¼Œæˆ‘ä¸æƒ³æ”¹ä»£ç è®­ç»ƒåˆ°å¤§çº¦23000stepï¼Œå¾—åˆ°æ­£ç¡®ç‡è¶…è¿‡97%çš„æ¨¡å‹ è®­ç»ƒæ•°æ®åœ¨ F:\\ctf\\ocr proj\\dddd-train\\dddd_trainer\\projects\\test\\modelsæ‰¾åˆ°onnxæ¨¡å‹å’Œcharsets.jsonå…ˆæµ‹è¯•ä¸€ä¸‹å•å¼ å›¾ç‰‡çš„è¯†åˆ«æƒ…å†µ æµ‹è¯•æ­¤onnxæ¨¡å‹èƒ½å¦æ­£å¸¸ä½¿ç”¨1234567891011121314151617181920import ddddocrimport numpy as np # æ·»åŠ è¿™è¡Œå¯¼å…¥è¯­å¥ocr = ddddocr.DdddOcr(det=False, ocr=False, import_onnx_path=r&quot;F:\\ctf\\ocr proj\\dddd-train\\dddd_trainer\\projects\\test\\models\\test_1.0_21_23000_2025-03-27-11-22-33.onnx&quot;, charsets_path=r&quot;F:\\ctf\\ocr proj\\dddd-train\\dddd_trainer\\projects\\test\\models\\charsets.json&quot;)# è®¾ç½®å­—ç¬¦èŒƒå›´ä¸ºå¤§å°å†™è‹±æ–‡+æ•°å­—ï¼ˆå¯¹åº”å‚æ•°6ï¼‰ocr.set_ranges(6)# è¯»å–å›¾ç‰‡ï¼ˆæ³¨æ„Windowsè·¯å¾„éœ€è¦è½¬ä¹‰ï¼‰image_path = r&quot;F:\\ctf\\ocr proj\\ddddocr-full\\sharpened_image.png&quot;with open(image_path, &quot;rb&quot;) as f: img_bytes = f.read()# è¿›è¡Œè¯†åˆ«å¹¶è·å–æ¦‚ç‡ç»“æœresult = ocr.classification(img_bytes, probability=True)# æ‹¼æ¥è¯†åˆ«ç»“æœs = &quot;&quot;.join([result[&#x27;charsets&#x27;][np.argmax(char_probs)] for char_probs in result[&#x27;probability&#x27;]])print(&quot;&quot;, s) é‡åˆ°äº†ç‚¹é—®é¢˜ è®©AIæ”¹ä¸€ä¸‹ä»£ç  æ‹¿åˆ°ä¿®æ”¹åçš„ä»£ç  è¯†åˆ«123456789101112131415161718192021222324252627import ddddocrimport numpy as npocr = ddddocr.DdddOcr( det=False, ocr=False, import_onnx_path=r&quot;F:\\ctf\\ocr proj\\dddd-train\\dddd_trainer\\projects\\test\\models\\test_1.0_21_23000_2025-03-27-11-22-33.onnx&quot;, charsets_path=r&quot;F:\\ctf\\ocr proj\\dddd-train\\dddd_trainer\\projects\\test\\models\\charsets.json&quot;)ocr.set_ranges(6)image_path = r&quot;F:\\ctf\\ocr proj\\ddddocr-full\\sharpened_image.png&quot;with open(image_path, &quot;rb&quot;) as f: img_bytes = f.read()# ç›´æ¥è·å–è¯†åˆ«ç»“æœï¼ˆæ¨èï¼‰result = ocr.classification(img_bytes)print(&quot;è¯†åˆ«ç»“æœ:&quot;, result)# è‹¥ç¡®å®éœ€è¦å¤„ç†æ¦‚ç‡è¾“å‡ºï¼ˆéœ€è¦ç¡®è®¤æ•°æ®ç»“æ„ï¼‰# å…ˆæ£€æŸ¥æ•°æ®ç»“æ„result_with_probs = ocr.classification(img_bytes, probability=True)print(&quot;æ•°æ®ç»“æ„:&quot;, type(result_with_probs))print(&quot;åŒ…å«çš„é”®:&quot;, result_with_probs.keys())print(&quot;probabilityç±»å‹:&quot;, type(result_with_probs[&#x27;probability&#x27;]))print(&quot;charsetsç±»å‹:&quot;, type(result_with_probs[&#x27;charsets&#x27;])) è¯†åˆ«æˆåŠŸè®©AIæŠŠå‰é¢çš„ä¸¤ä¸ªæ»¤æ³¢+ocr+éªŒè¯è„šæœ¬åˆåœ¨ä¸€èµ· æ”»å‡»123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108import requestsimport ddddocrimport numpy as npfrom PIL import Imageimport colorsysfrom io import BytesIOimport os # æ·»åŠ è·¯å¾„éªŒè¯def process_image(img_content): def rgb_to_hsv(rgb): return colorsys.rgb_to_hsv(rgb[0]/255.0, rgb[1]/255.0, rgb[2]/255.0) def remove_specific_rgba(img, target_rgba): img = img.convert(&quot;RGBA&quot;) data = np.array(img) r, g, b, a = data[:,:,0], data[:,:,1], data[:,:,2], data[:,:,3] mask = (r == target_rgba[0]) &amp; (g == target_rgba[1]) &amp; (b == target_rgba[2]) &amp; (a == target_rgba[3]) data[mask] = [0, 0, 0, 0] return Image.fromarray(data) # å‚æ•°è®¾ç½® target_blue = (64, 56, 247) hue_range = (0.58, 0.72) sat_threshold = 0.3 val_threshold = 0.5 remove_color = (254, 224, 222, 255) # ä»å­—èŠ‚æµè¯»å–å›¾ç‰‡ img = Image.open(BytesIO(img_content)).convert(&quot;RGB&quot;) pixels = np.array(img) # HSVè¿‡æ»¤ hsv_pixels = np.array([[[colorsys.rgb_to_hsv(p[0]/255., p[1]/255., p[2]/255.)] for p in row] for row in pixels]).squeeze() combined_mask = (hsv_pixels[:,:,0] &gt;= hue_range[0]) &amp; (hsv_pixels[:,:,0] &lt;= hue_range[1]) &amp; \\ (hsv_pixels[:,:,1] &gt;= sat_threshold) &amp; (hsv_pixels[:,:,2] &gt;= val_threshold) pixels[combined_mask] = [255, 255, 255] color_img = remove_specific_rgba(Image.fromarray(pixels), remove_color) # è½¬æ¢ä¸ºç°åº¦ gray_img = color_img.convert(&#x27;L&#x27;) # ç¬¬äºŒé˜¶æ®µï¼šé”åŒ–å¤„ç† sharpen_kernel = np.array([[0, -1, 0], [-1, 5, -1], [0, -1, 0]], dtype=np.float32) img_array = np.array(gray_img, dtype=np.float32) filtered = np.zeros_like(img_array) for i in range(1, img_array.shape[0]-1): for j in range(1, img_array.shape[1]-1): filtered[i, j] = np.sum(img_array[i-1:i+2, j-1:j+2] * sharpen_kernel) sharpened = np.clip(filtered, 0, 255).astype(np.uint8) # ç¬¬ä¸‰é˜¶æ®µï¼šOCRè¯†åˆ«ï¼ˆå…³é”®ä¿®æ”¹éƒ¨åˆ†ï¼‰ try: # è·¯å¾„éªŒè¯ï¼ˆè°ƒè¯•ç”¨ï¼‰ print(&quot;æ¨¡å‹å­˜åœ¨:&quot;, os.path.exists(r&quot;F:\\ctf\\ocr proj\\dddd-train\\dddd_trainer\\projects\\test\\models\\test_1.0_21_23000_2025-03-27-11-22-33.onnx&quot;)) print(&quot;å­—ç¬¦é›†å­˜åœ¨:&quot;, os.path.exists(r&quot;F:\\ctf\\ocr proj\\dddd-train\\dddd_trainer\\projects\\test\\models\\charsets.json&quot;)) # åˆå§‹åŒ–OCRå¼•æ“ ocr = ddddocr.DdddOcr( det=False, ocr=False, import_onnx_path=r&quot;F:\\ctf\\ocr proj\\dddd-train\\dddd_trainer\\projects\\test\\models\\test_1.0_21_23000_2025-03-27-11-22-33.onnx&quot;, charsets_path=r&quot;F:\\ctf\\ocr proj\\dddd-train\\dddd_trainer\\projects\\test\\models\\charsets.json&quot; ) ocr.set_ranges(6) # è®¾ç½®å­—ç¬¦èŒƒå›´ img_buffer = BytesIO() Image.fromarray(sharpened).save(img_buffer, format=&#x27;PNG&#x27;) img_bytes = img_buffer.getvalue() # ç›´æ¥è·å–è¯†åˆ«ç»“æœ result_text = ocr.classification(img_bytes) return result_text.replace(&quot; &quot;, &quot;&quot;).strip() except Exception as e: print(f&quot;OCRå¼•æ“å¼‚å¸¸: &#123;str(e)&#125;&quot;) return &quot;ERROR&quot;# è‡ªåŠ¨åŒ–å¾ªç¯éƒ¨åˆ†with requests.Session() as s: base_url = &quot;http://c15f4704-4db8-4b6f-8e09-f80cd4c22d1b.ctf.szu.moe/&quot; for i in range(1, 2001): try: # è·å–éªŒè¯ç  captcha_resp = s.get(f&quot;&#123;base_url&#125;/generate_captcha.php&quot;) if captcha_resp.status_code != 200: print(f&quot;ç¬¬&#123;i&#125;æ¬¡: è·å–éªŒè¯ç å¤±è´¥&quot;) continue # å¤„ç†è¯†åˆ« captcha_text = process_image(captcha_resp.content) print(f&quot;ç¬¬&#123;i&#125;æ¬¡è¯†åˆ«ç»“æœ: &#123;captcha_text&#125;&quot;) # æäº¤éªŒè¯ post_resp = s.post( f&quot;&#123;base_url&#125;/verify.php&quot;, data=&#123;&quot;captcha_input&quot;: captcha_text&#125; ) print(f&quot;ç¬¬&#123;i&#125;æ¬¡å“åº”: &#123;post_resp.text.strip()&#125;&quot;) except Exception as e: print(f&quot;ç¬¬&#123;i&#125;æ¬¡å‘ç”Ÿå¼‚å¸¸: &#123;str(e)&#125;&quot;) continueprint(&quot;æ‰€æœ‰å¾ªç¯å®Œæˆ&quot;) ç›´æ¥æ‰“å³å¯ æ‹¿åˆ°flag"}]